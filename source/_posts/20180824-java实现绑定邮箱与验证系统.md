---
title: javaå®ç°ç»‘å®šé‚®ç®±ä¸éªŒè¯ç³»ç»Ÿ
urlname: UseJava2ImplimentTheEmail-bindingSystem
date: 2018-08-24 00:27:21
tags: [AES, Java, SpringBoot, Authentication]
---

æœ€è¿‘åœ¨å†™çš„ä¸€ä¸ªç½‘ç»œå®‰å…¨ç®¡æ§é¡¹ç›®éœ€è¦ç”¨æˆ·åœ¨è´¦å·ä¸­ç»‘å®šè‡ªå·±çš„é‚®ç®±, ä»¥ä¾¿åœ¨å‘ç°ç”¨æˆ·è´¦æˆ·å­˜åœ¨å¼‚å¸¸ä¹‹å, åŠæ—¶é€šè¿‡é‚®ä»¶æ–¹å¼é€šçŸ¥ç”¨æˆ·å’Œç®¡ç†å‘˜. 

åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹åŸºäºSpringBootæ¡†æ¶çš„è®¾è®¡ä¸å®ç°è¿‡ç¨‹.

<!-- more -->

# ä¸€. æƒ³æ³•
è·Ÿæˆ‘ä»¬ä»¥å‰åœ¨å…¶ä»–å¹³å°æ³¨å†Œè´¦å·ç»‘å®šé‚®ç®±ä¸€æ ·, å¯¹äºç»‘å®šé‚®ç®±, æˆ‘ä»¬éœ€è¦ç¡®è®¤ç”¨æˆ·å¯¹æ‰€ç»‘å®šé‚®ç®±çš„æ‰€æœ‰æƒ, åœ¨ç”¨æˆ·è¿›è¡Œç»‘å®šæ“ä½œå, ç³»ç»Ÿä¼šå‘é€ä¸€å°å¸¦æœ‰éªŒè¯é“¾æ¥çš„é‚®ä»¶ç»™å¯¹åº”çš„é‚®ç®±, ç”¨æˆ·ç™»å½•é‚®ä»¶ç‚¹å‡»é“¾æ¥è¿›è¡ŒéªŒè¯.

## é“¾æ¥é—®é¢˜
å¯¹äºé“¾æ¥, å…¶ä¸­åº”è¯¥æ”¾ç½®æ‰€æœ‰çš„èƒ½å¤Ÿç”¨æ¥åˆ¤æ–­ç”¨æˆ·ä¸é‚®ç®±å¯¹åº”å…³ç³»ä»¥åŠé“¾æ¥æœ‰æ•ˆæ€§çš„ä¿¡æ¯, è€Œä¸”è¿™äº›ä¿¡æ¯åº”è¯¥åŠ å¯†æˆä¸€ä¸ªå¯†æ–‡(è¿™é‡Œæˆ‘ä»¬å°±å«å®ƒ`secret`å§, ä¸‹åŒ)ä½œä¸ºå‚æ•°æ”¾åœ¨é“¾æ¥ä¸­. 

è‡³äºéªŒè¯é“¾æ¥çš„æœ‰æ•ˆæ€§, æˆ‘ä»¬å¯ä»¥åœ¨ç”Ÿæˆsecretä¹‹å‰è·å–å½“å‰æ—¶é—´ä¿¡æ¯ä½œä¸ºå‚è€ƒåŸºå‡†åŠ å…¥åˆ°secretä¸­, è¿™æ ·ç³»ç»Ÿæ¥æ”¶secretåˆ°åè§£å¯†, æ‹¿åˆ°ä½œä¸ºå‚è€ƒåŸºå‡†çš„æ—¶é—´ä¸å½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒ, è¶…è¿‡è§„å®šçš„æœ‰æ•ˆæœŸé™åˆ™è§†ä¸ºå¤±æ•ˆé“¾æ¥.

## åŠ å¯†è§£å¯†ç®—æ³•
é‚£ä¹ˆåŠ å¯†å¾ˆé‡è¦äº†.

è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯AESçš„åŠ å¯†ç®—æ³•, è¯¥ç®—æ³•æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•(å› ä¸ºæ­¤å¤„ä¸æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„åœºæ™¯, ä¸”ä½¿ç”¨å¯¹ç§°åŠ å¯†å¯ä»¥è·å–è¾ƒå¿«çš„åŠ å¯†è§£å¯†é€Ÿåº¦), è€Œåœ¨å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­AESæ˜¯éå¸¸å¥½çš„é€‰æ‹©, ä¸ä»…é€Ÿåº¦å¿«, ä¸”ç›¸å¯¹ä¹Ÿæ›´å®‰å…¨.

## éªŒè¯æµç¨‹
æ‰€ä»¥æµç¨‹å°±åº”è¯¥æ˜¯ç”¨æˆ·åœ¨ç»‘å®šé‚®ç®±çš„æ—¶å€™, æäº¤éœ€è¦ç»‘å®šçš„é‚®ç®±, ç„¶åç³»ç»Ÿæ¥æ”¶åˆ°è¯·æ±‚ä¹‹åå°†ç”¨æˆ·è´¦å·ã€è¦ç»‘å®šçš„é‚®ç®±ä»¥åŠå½“å‰æ—¶é—´åŠ å¯†ä¸ºsecret, ä½œä¸ºå‚æ•°åŠ åˆ°çš„åé¢, å°†è¯¥é“¾æ¥æ”¾åˆ°é‚®ä»¶ä¸­å‘ç»™ç”¨æˆ·è¦ç»‘å®šçš„é‚®ç®±, ç”¨æˆ·æ¥æ”¶åˆ°éªŒè¯é‚®ä»¶å, ç‚¹å‡»é‡Œé¢çš„é“¾æ¥, ä¹Ÿå°±æ˜¯è¯·æ±‚äº†éªŒè¯é‚®ç®±æœ‰æ•ˆæ€§çš„API, ç³»ç»Ÿæ¥å—åˆ°è¯·æ±‚åæå–å…¶ä¸­çš„secretå‚æ•°, è§£å¯†è·å–åˆ°ç”¨æˆ·è´¦å·ã€è¦ç»‘å®šçš„é‚®ç®±ä»¥åŠä½œä¸ºå‚è€ƒåŸºå‡†çš„æ—¶é—´, å…ˆå°†ä½œä¸ºå‚è€ƒåŸºå‡†çš„æ—¶é—´ä¸å½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒ, åœ¨è§„å®šçš„æœ‰æ•ˆæœŸé™å†…åˆ™è¿›è¡Œç»‘å®š, å°†é‚®ç®±ä¸ç”¨æˆ·è´¦å·ç›¸å¯¹åº”ä¿å­˜åˆ°æ•°æ®åº“, è‡³æ­¤å®Œæˆç»‘å®š.

# äºŒ. å®ç°
è¿™é‡Œè¯¦è¿°ä¸€ä¸‹ä»£ç å®ç° ğŸ‘‡

## é…ç½®æ–‡ä»¶
é¡¹ç›®é…ç½®æ–‡ä»¶`application.yml`ä¸­å¿…è¦çš„éƒ¨åˆ†é…ç½® ğŸ‘‡

```
server:
    ip: host ip/domain    #æ‰€éƒ¨ç½²æœåŠ¡å™¨çš„åœ°å€(ipæˆ–åŸŸå)
    port: port				    #åç«¯æœåŠ¡æ‰€å ç«¯å£

# é…ç½®ç³»ç»Ÿæ‰€ç”¨é‚®ç®±è´¦å·
email:
    username: name@***.com      #æ‰€ä½¿ç”¨çš„é‚®ç®±åœ°å€
    password: password          #é‚®ç®±åœ°å€çš„å®¢æˆ·ç«¯æˆæƒå¯†ç ,åŒºåˆ«äºé‚®ç®±å¯†ç ,ä¸€èˆ¬åœ¨å¼€å¯SMTPæœåŠ¡æ—¶è¦æ±‚è®¾ç½®
    protocol: smtp              #æ‰€ç”¨å‘ä»¶åè®®,é»˜è®¤ä¸ºsmtp
    host: host addr             #æ‰€ç”¨é‚®ç®±çš„æœåŠ¡æä¾›å•†çš„æœåŠ¡å™¨åœ°å€,å¦‚ç½‘æ˜“163é‚®ç®±çš„æ˜¯ smtp.163.com
    port: 465                   #æ‰€ç”¨é‚®ç®±çš„æœåŠ¡æä¾›å•†çš„æœåŠ¡å™¨å¯¹åº”çš„å‘ä»¶åè®®æœåŠ¡çš„ç«¯å£,å¦‚smtpåè®®å»ºè®®ä½¿ç”¨465ç«¯å£,åŸºäºsslæ›´å®‰å…¨
    							#å…³äºä½¿ç”¨465ç«¯å£çš„é—®é¢˜, è¿˜æœ‰ä¸ªåŸå› å°±æ˜¯å¾ˆå¤šäº‘æœåŠ¡å™¨æä¾›å•†ä¼šå°é—­25ç«¯å£, åé¢ä¼šæœ‰æåŠ
```

## å‘é€é‚®ä»¶çš„åŠŸèƒ½å®ç°
å‘é€é‚®ä»¶çš„å·¥å…·ç±»`EmailUtil` ğŸ‘‡

```
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import javax.mail.*;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.util.Date;
import java.util.Properties;

@Service
public class EmailUtil {

    private static String HOST;
    private static String PROTOCOL;
    private static int PORT;
    private static String EMAILADDRESS;
    private static String PASSWORD;

    private static Session getSession() {
        Properties props = new Properties();
        props.put("mail.smtp.host", HOST);//è®¾ç½®æœåŠ¡å™¨åœ°å€
        props.put("mail.store.protocol", PROTOCOL);//è®¾ç½®åè®®
        props.put("mail.smtp.port", PORT);//è®¾ç½®ç«¯å£
        props.put("mail.smtp.auth", "true");
        props.setProperty("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
        props.setProperty("mail.smtp.socketFactory.fallback", "false");
        props.setProperty("mail.smtp.socketFactory.port", String.valueOf(PORT));

        Authenticator authenticator = new Authenticator() {
            @Override
            protected PasswordAuthentication getPasswordAuthentication() {
                return new PasswordAuthentication(EMAILADDRESS, PASSWORD);
            }
        };
        return Session.getDefaultInstance(props, authenticator);
    }

    public static boolean send(String toEmail, String content) {
        Session session = getSession();
        try {
            Message msg = new MimeMessage(session);
            msg.setFrom(new InternetAddress(EMAILADDRESS));
            InternetAddress[] address = {new InternetAddress(toEmail)};
            msg.setRecipients(Message.RecipientType.TO, address);
            msg.setSubject("[æ¥è‡ªeduroamå®‰å…¨ç®¡æ§ç³»ç»Ÿçš„é‚®ä»¶]");
            msg.setSentDate(new Date());
            msg.setContent(content, "text/html;charset=utf-8");
            msg.saveChanges();
            Transport.send(msg);
            return true;
        } catch (MessagingException mex) {
            mex.printStackTrace();
        }
        return false;
    }

    @Value("${email.host}")
    public void setHOST(String HOST) {
        EmailUtil.HOST = HOST;
    }

    @Value("${email.protocol}")
    public void setPROTOCOL(String PROTOCOL) {
        EmailUtil.PROTOCOL = PROTOCOL;
    }

    @Value("${email.port}")
    public void setPORT(int PORT) {
        EmailUtil.PORT = PORT;
    }

    @Value("${email.username}")
    public void setEMAILADDRESS(String EMAILADDRESS) {
        EmailUtil.EMAILADDRESS = EMAILADDRESS;
    }

    @Value("${email.password}")
    public void setPASSWORD(String PASSWORD) {
        EmailUtil.PASSWORD = PASSWORD;
    }
}
```

## AESåŠ å¯†åŠŸèƒ½
åˆ©ç”¨AESå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ä¸è§£å¯†çš„å·¥å…·ç±»`AESCrypt` ğŸ‘‡

```
import sun.misc.BASE64Decoder;
import sun.misc.BASE64Encoder;
import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import java.security.Key;
import java.security.SecureRandom;

/**
 * AESåŠ å¯†è§£å¯†å·¥å…·ç±»
 * åˆ©ç”¨AESå¯¹ç§°åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ä¸è§£å¯†
 *
 * Created by jay on 2018/08/23
 */

public class AESCrypt {
    private static String defaultKeySeed = "this is a test"; //è®¾ç½®é»˜è®¤çš„åŠ å¯†å¯†é’¥, æ ¹æ®è‡ªå·±éœ€è¦è®¾ç½®

    public static String encrypt(String plainText) {
        Key secretKey = getKey(null);
        try {
            Cipher cipher = Cipher.getInstance("AES");
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            byte[] plain = plainText.getBytes("UTF-8");
            byte[] result = cipher.doFinal(plain);
            BASE64Encoder encoder = new BASE64Encoder();
            return encoder.encode(result);
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    public static String decrypt(String cipherText) {
        Key secretKey = getKey(null);
        try {
            Cipher cipher = Cipher.getInstance("AES");
            cipher.init(Cipher.DECRYPT_MODE, secretKey);
            BASE64Decoder decoder = new BASE64Decoder();
            byte[] encrypted = decoder.decodeBuffer(cipherText);
            byte[] result = cipher.doFinal(encrypted);
            return new String(result, "UTF-8");
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    private static Key getKey(String keySeed) {
        if (keySeed == null) {
            keySeed = System.getenv("AES_SYS_KEY");
        }
        if (keySeed == null) {
            keySeed = System.getProperty("AES_SYS_KEY");
        }
        if (keySeed == null || keySeed.trim().length() == 0) {
            keySeed = defaultKeySeed;
        }
        try {
            SecureRandom secureRandom = SecureRandom.getInstance("SHA1PRNG");
            secureRandom.setSeed(keySeed.getBytes());
            KeyGenerator generator = KeyGenerator.getInstance("AES");
            generator.init(secureRandom);
            return generator.generateKey();
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }
}
```

## Controllerçš„ä¸šåŠ¡é€»è¾‘ä»£ç 
```
import com.alibaba.fastjson.JSON;
import io.swagger.annotations.ApiImplicitParam;
import io.swagger.annotations.ApiImplicitParams;
import io.swagger.annotations.ApiOperation;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.servlet.http.HttpServletRequest;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

@RestController
@RequestMapping("UserController")
public class UserController {
    @Autowired
    private HttpServletRequest request;
    @Autowired
    private UserService userService;
    @Autowired
    private GetUserIdFromRequest getUserIdFromRequest;	
    //ç”±äºæœ¬é¡¹ç›®ä½¿ç”¨äº†JWT, GetUserIdFromRequestç±»æ˜¯ç”¨æ¥ä»è¯·æ±‚ä¸­æå–tokenåä»tokenè·å–ç”¨æˆ·idçš„.

    private final Log logger = LogFactory.getLog(this.getClass());

    @Value("${server.ip}" + ":" + "${server.port}")
    private String target;

    @ApiOperation(value = "ç”¨äºæ‰€æœ‰ç”¨æˆ·ç»‘å®šé‚®ç®±")
    @ApiImplicitParams({
            @ApiImplicitParam(paramType = "query", name = "emailAddress", value = "é‚®ç®±åœ°å€", required = true, dataType = "String"),
    })
    @PostMapping("/BindEmail")
    public Object bindEmail(String emailAddress) {
        if (userService.findFirstByEmailAddress(emailAddress) != null)
            return new ResponseMessage(-1, "æ“ä½œå¤±è´¥! è¯¥é‚®ç®±å·²è¢«ç»‘å®š!");
        String userId = getUserIdFromRequest.getUserId(request);
        long generateDate = new Date().getTime();
        Map<String, Object> map = new HashMap<>();
        map.put("userId", userId);
        map.put("emailAddress", emailAddress);
        map.put("generateDate", generateDate);
        String json = JSON.toJSONString(map);
        String secret = AESCrypt.encrypt(json);
        System.out.println("email secret: " + secret);
        String url = "http://" + target + "/UserController/VerifyEmail?secret=" + secret;
        StringBuffer stringBuffer = new StringBuffer();
        stringBuffer.append("æ‚¨å¥½ï¼Œ</br>").
                append("è¿™æ˜¯eduroamå®‰å…¨ç®¡æ§ç³»ç»Ÿé‡Œç»‘å®šé‚®ç®±çš„éªŒè¯é‚®ä»¶ã€‚</br>").
                append("è‹¥è¦æœ€ç»ˆéªŒè¯æ‚¨çš„ç”µå­é‚®ç®±åœ°å€, è¯·ç‚¹å‡»ä»¥ä¸‹é“¾æ¥éªŒè¯é‚®ç®±ï¼Œ48å°æ—¶å†…æœ‰æ•ˆï¼Œè¯·å°½å¿«éªŒè¯ã€‚</br>").
                append("<a href=\"").
                append(url).
                append("\">").
                append(url).
                append("</a></br>").
                append("å¦‚æœå•å‡»é“¾æ¥æ— æ•ˆï¼Œæ‚¨å¯ä»¥å°†æ­¤é“¾æ¥å¤åˆ¶åˆ°æµè§ˆå™¨çª—å£ï¼Œæˆ–åœ¨æµè§ˆå™¨çª—å£ä¸­ç›´æ¥è¾“å…¥ã€‚");
        if (EmailUtil.send(emailAddress, stringBuffer.toString())) {
            logger.info("å·²å‘é€ç”¨æ¥ç»‘å®šé‚®ç®±çš„éªŒè¯é‚®ä»¶åˆ°" + emailAddress);
            return new ResponseMessage(0, "ç³»ç»Ÿå·²å‘é€éªŒè¯é‚®ä»¶,è¯·å»é‚®ç®±æŸ¥çœ‹å¹¶è¿›è¡ŒéªŒè¯");
        } else
            return new ResponseMessage(-1, "ç³»ç»Ÿå‘é€é‚®ä»¶å¤±è´¥,è¯·ç¨åå†è¯•");
    }

    @ApiOperation(value = "ç”¨äºéªŒè¯ç”¨æˆ·çš„ç»‘å®šé‚®ç®±")
    @ApiImplicitParams({
            @ApiImplicitParam(paramType = "query", name = "emailAddress", value = "é‚®ç®±åœ°å€", required = true, dataType = "String"),
    })
    @GetMapping("/VerifyEmail")
    public Object verifyEmail(String secret) {
        secret = secret.replace(' ', '+');
        try {
            String json = AESCrypt.decrypt(secret);
            Map data = JSON.parseObject(json);
            String userId = data.get("userId").toString();
            long generateDate = (long) data.get("generateDate");
            String emailAddress = data.get("emailAddress").toString();
            long nowTime = new Date().getTime();
            if ((nowTime - generateDate) / 1000 / 60 / 60 <= 48) {
                User user = userService.findFirstByUserId(userId);
                if (user != null) {
                    user.setEmailAddress(emailAddress);
                    userService.update(user);
                    logger.info(userId + "å·²ç»‘å®šé‚®ç®±" + emailAddress);
                    return "<h1>ğŸ˜„é‚®ç®±ç»‘å®šæˆåŠŸ!</h1>";
                } else
                    return "<h1>ğŸ˜±æŸ¥æ— æ­¤ç”¨æˆ·,éªŒè¯å¤±è´¥!</h1>";
            } else {
                return "<h1>ğŸ˜¥è¶…å‡ºéªŒè¯æ—¶é—´,éªŒè¯å¤±è´¥,è¯·é‡æ–°è¯·æ±‚ç»‘å®š!</h1>";
            }
        } catch (Exception e) {
            return "<h1>ğŸ¤’æ£€æµ‹åˆ°éæ³•çš„secret</h1>";
        }
    }
}
```
## å®Œæ•´çš„é¡¹ç›®
å®Œæ•´çš„é¡¹ç›®åœ°å€ ğŸ‘‰ [eduroamControlSystem-Backend](https://github.com/UPC-eduroam/eduroamControlSystem-Backend)

# ä¸‰. é“¾æ¥çš„ä¸€æ¬¡æ€§
å½“ç„¶äº†, å¦‚æœä½ è¦æ±‚æ›´åŠ ä¸¥æ ¼çš„è¯å¯ä»¥è€ƒè™‘å°†ç”Ÿæˆåçš„secretä¿å­˜åˆ°æ•°æ®åº“, ç„¶ååœ¨ç”¨æˆ·ç‚¹å‡»éªŒè¯çš„æ—¶å€™æŸ¥è¯¢ä¸€éè¯¥secretæ˜¯å¦åœ¨åº“ä¸­, å­˜åœ¨åˆ™è¯´æ˜è¯¥secretæœ‰æ•ˆ, å°±å°†secretä»åº“ä¸­åˆ é™¤å¹¶è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ, ä¸åœ¨åˆ™è¯´æ˜è¯¥secretæ˜¯æ— æ•ˆçš„.

è¿™æ ·èƒ½å¤Ÿä¿è¯secretçš„æœ‰æ•ˆæ€§å’Œä¸€æ¬¡æ€§, æ•°æ®åº“çš„è¯å¯ä»¥è€ƒè™‘ä½¿ç”¨redisä»¥ä¿è¯æ•ˆç‡.

# å››. urlçš„ç¼–ç é—®é¢˜
è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯, æœ¬æ¥ä¸€ä¸ªsecretæ˜¯ ğŸ‘‡

```
oUWyWz0MWtTxbKQtu1KVugVTvzR3ERTekz2tDettUqqtZ3No3XDqA6PE5zFUFsYHlkj+VmUiuGwh5tlMQBRKPh+25Tmt779zbuxhnbSBXUZ4aeRmwpMHfRx6/+ItVw+5
```

ä½†æ˜¯ä½œä¸ºå‚æ•°ä¼ å…¥controllerçš„æ–¹æ³•å, æ‰“å°å‡ºæ¥å´æ˜¯ ğŸ‘‡

```
oUWyWz0MWtTxbKQtu1KVugVTvzR3ERTekz2tDettUqqtZ3No3XDqA6PE5zFUFsYHlkj VmUiuGwh5tlMQBRKPh 25Tmt779zbuxhnbSBXUZ4aeRmwpMHfRx6/ ItVw 5
```

å¯ä»¥å‘ç°æ‰€æœ‰çš„`+`éƒ½è¢«æ›¿æ¢æˆäº†ç©ºæ ¼, è¿™æ ·åœ¨è§£ç çš„æ—¶å€™å°±ä¼šå‡ºç°é—®é¢˜
è¿™é‡Œç”±äºAESåœ¨åŠ å¯†çš„æ—¶å€™ä¸ä¼šäº§ç”Ÿç©ºæ ¼, æ‰€ä»¥æ•´ä¸ªsecretä¸€å®šä¸ä¼šæœ‰ç©ºæ ¼, æ•…ä½ å¯ä»¥ä½¿ç”¨æ›¿æ¢çš„æ–¹æ³•å°†æ¥æ”¶åˆ°çš„secretä¸­çš„ç©ºæ ¼ç›´æ¥æ›¿æ¢æˆ`+`, è¿™ä¹Ÿæ˜¯æˆ‘é‡‡ç”¨çš„; æˆ–è€…ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨URLEncoderè¿›è¡Œç¼–ç 

# äº”. SMTPä½¿ç”¨25ç«¯å£è¿˜æ˜¯465ç«¯å£
SMTPåè®®é»˜è®¤æ˜¯ä½¿ç”¨25ç«¯å£, ä½†æ˜¯éƒ¨åˆ†äº‘æœåŠ¡å™¨æä¾›å•†è€ƒè™‘åˆ°smtpæœåŠ¡çš„å®‰å…¨æ€§é—®é¢˜, å¯èƒ½ä¼šå°é—­25ç«¯å£, å¦‚æœæ˜¯è¿™æ ·çš„è¯, é‚£ä¹ˆç¨‹åºå°†æ— æ³•é€šè¿‡25ç«¯å£è¿æ¥åˆ°é‚®ä»¶æœåŠ¡æä¾›å•†çš„æœåŠ¡å™¨, ä¼šæŠ¥`Could not connect to SMTP host`çš„é”™è¯¯, æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦æ¢ä¸‹ç«¯å£, ä½¿ç”¨465ç«¯å£è¿›è¡Œå‘ä»¶ ğŸ‘‡

```
props.setProperty("mail.smtp.port", "465");
props.setProperty("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
props.setProperty("mail.smtp.socketFactory.fallback", "false");
props.setProperty("mail.smtp.socketFactory.port", "465");
```

å€¼å¾—ä¸€æçš„æ˜¯, 465ç«¯å£æ˜¯SMTPSæœåŠ¡çš„ç«¯å£, SMTPSåè®®æ˜¯SMTPåè®®åŸºäºSSLåè®®çš„å˜ç§åè®®, è¾ƒSMTPåè®®æ›´å®‰å…¨, å½“ç„¶äº†, å¯ä»¥ç±»æ¯”HTTPSä¹‹äºHTTP.