---
title: 图片低损压缩
date: 2017-10-15 19:07:14
tags: [python]
---
### 前言
因为有时上传到博客的图片会比较大，所以就想到要压缩一下来减轻网络负载，因为我一般对质量要求不高，所以有点损失的话也无所谓。
<!--more-->
### 详述
首先我去查了下压缩的方法，知乎上有个方法挺好使的，即“先转成GIF图片，再转成png图片”，我用PS试了下，都是直接用最高品质直接保存，结果图片大小由将近2M降为1M出头，接近一半，当然了，质量在过程中是有损的，不过不放大了仔细看的话基本看不出什么区别。

当然当然，肯定不可能每压缩一张图片就要拉到PS里去，这里只是讲述一种可行方法。

那就用python写个脚本吧。网上查了下文档发现Image模块处理到最后保存有一个quality参数可选，试试：

```python
from PIL import Image
import os,sys

imgFile=sys.argv[1]
inputName = os.path.splitext(imgFile.split("/")[-1])
suffix=inputName[1]#图片后缀名
outputName=inputName[0]+"-convert"#保存的图片名
try:
	inputFile=Image.open(imgFile)
	inputFile.save(outputName+".jpg",quality=80)
	print("\ncompression success")
except Exception as e:
	print("\ncompression failure")
```
执行脚本带上一个图片路径参数（windows下请注意用“\\\”对路径进行分割），测试中一张1.31M的图片压缩后为201K，效果还是可以的，图就不贴出了，可以自己转一下试试。

quality参数最终定在80是因为这样压缩率很大但图片质量损失不会很大，可以自行选择合适的。

对于GIF图片的压缩，我直接调用了[WebP官网](https://developers.google.com/speed/webp/docs/gif2webp)提供的gif2webp程序，反正现在主流浏览器都支持webp格式，况且webp的优势那么大。[下载地址在这里](https://storage.googleapis.com/downloads.webmproject.org/releases/webp/index.html)。


最终的代码只是整合了一下，就不贴出了，[代码地址在这](https://github.com/VanjayDo/scripts/blob/master/imgCompress.py)。


### 赘述
jpg、png等也可以用WebP官网提供的img2webp程序转成webp，但是压缩率…………有时（我测试的几张图都是）会是负数。